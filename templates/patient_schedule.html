<html>
<head>
	<title>Patient Schedule</title>
	{% load staticfiles %}
  {% load range %}
  <script src="//code.jquery.com/jquery-1.10.2.js"></script>
  <script src="//code.jquery.com/ui/1.11.3/jquery-ui.js"></script>
  <script type="text/javascript" src="{% static 'jquery.cookie.js' %}"></script>
  <link href="{% static 'x_rotating_card/css/bootstrap.css' %}" rel="stylesheet"/>
  <link href="{% static 'x_rotating_card/css/rotating-card.css' %} " rel="stylesheet"/>
  <link href="http://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" />
  <link href="{% static 'mysite.css' %}" rel="stylesheet" />
  <style>
   #draggable, #draggable2 { width: 90px; height: 90px; padding: 0.5em; float: left; margin: 10px 10px 10px 0; }
   #droppable2 { width: 120px; height: 120px; padding: 0.5em; float: left; margin: 10px; }
   h3 { clear: left; }
  </style>
  <script>
   $(function() {
       $( "#draggable" ).draggable();

       $( "#draggable2" ).draggable();
       $( "#droppable2" ).droppable({
           accept: "#draggable2",
           activeClass: "ui-state-default",
           drop: function( event, ui ) {
               $( this )
          .addClass( "ui-state-highlight" )
          .find( "p" )
          .html( "Vaccinated!" );
           }
       });
   });
  </script>
</head>
<body>
    <div class="container">
        <a href="{% url 'logout' %}">Logout</a>
        <h2>{{ patient.name }} ({{ patient.birthdate }})</h2>
	      <table>
		        <tr>
			          <th>Vaccine</th>
			          {% for m in months %}
			              <th>{{ m }}</th>
			          {% endfor %}
		        </tr>
            <tr>
                <td rowspan="2">Hepatitis B</td>
                <td colspan="3">1st Dose</td>
                <td></td>
                <td rowspan="2" colspan="4">3rd Dose</td>
                <td></td>
                <td></td>
                <td rowspan="2">catch up</td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td colspan="3">2nd Dose</td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td rowspan="2">Diptheria, Tetanus, Pertussis</td>
                <td></td>
                <td></td>
                <td rowspan="2">1st dose</td>
                <td rowspan="2">2nd dose</td>
                <td rowspan="2">3rd dose</td>
                <td></td>
                <td colspan="2" rowspan="2">4th dose</td>
                <td></td>
                <td rowspan="2">5th dose</td>
                <td rowspan="2" colspan="2">Tetanus + Diptheria</td> 
           </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>H.Influenzae type B</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>Inactivated Polio</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>Pneumococcal Conjugate</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>Measles, Mumps, Rubella</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>Varicella (Chickenpox)</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>Hepatitis A</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
	      </table>
        <div id="draggable" class="ui-widget-content">
            <h4>Drag&Drop to Vaccinate</h4>
        </div>
    </div>
    <script>
     $(document).ready(function () {
         var csrftoken = $.cookie('csrftoken');

         function csrfSafeMethod(method) {
             // these HTTP methods do not require CSRF protection
             return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
         };

       {% for S in schedules %}
       {% if S.dose_due %}
       $( "#droppable-{{ S.scheduleId}}-{{S.dose_key}}" ).droppable({
           hoverClass: "ui-state-hover",
           drop: function( event, ui ) {
               $( this )
                  .addClass( "ui-state-highlight" )
                  .find( "div" )
                  .html( "Vaccinated!" );

               $.ajaxSetup({
                    beforeSend: function(xhr, settings) {
                        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                            // send the token to same-origin, relative URLs only.
                            // Send the token only if the method warrants CSRF protection
                            // Using the CSRFToken value acquired earlier
                            xhr.setRequestHeader("X-CSRFToken", csrftoken);
                        }
                    }
               });

               var obj = {}
               $.ajax({
                        url: '{% url 'vaccinate' %}',
                        type: 'POST',
                        data: obj,
                        success: function(res) {},
                        complete: function() {},
                        error: function (xhr, textStatus, thrownError) {}
                    });
           }
       });
       {% endif %}
       {% endfor %}
     });
    </script>

</body>
</html>
